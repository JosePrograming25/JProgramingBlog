---
import Layout from "../layouts/Layout.astro";
import PostCard from "../components/PostCard.astro";

// Datos REALES de proyectos
const projects = [
  {
    title: "Pixplorer",
    description: "Explorador de im√°genes moderno y minimalista consumiendo la API de Pexels.",
    date: "2025-12-10",
    image: "/assets/projects/pixplorer_thumb.png",
    demoUrl: "https://pixplorer-jprograming25.netlify.app",
    repoUrl: "https://github.com/JosePrograming25/piexplorer",
    tags: ["React", "API", "Netlify"]
  },
  {
    title: "Task List App",
    description: "Gestor de tareas eficiente para organizar tu d√≠a a d√≠a con persistencia local.",
    date: "2025-11-05",
    image: "/assets/projects/tasklist_thumb.png",
    demoUrl: "https://task-list-jprograming25.netlify.app/",
    repoUrl: "https://github.com/JosePrograming25/-task-list",
    tags: ["JS Vanilla", "LocalStorage", "CSS"]
  }
];
---

<Layout title="Proyectos - JPrograming25">
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    
    <header class="text-center mb-16 space-y-4">
      <h1 class="text-4xl md:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500">
        Mis Proyectos üõ†Ô∏è
      </h1>
      <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
        Aplicaciones funcionales desplegadas y listas para usar.
      </p>
    </header>

    <!-- Grid de Proyectos -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {
        projects.map((project) => (
          <article class="bg-white dark:bg-[#1e1e1e] rounded-2xl overflow-hidden border border-gray-200 dark:border-gray-800 shadow-sm hover:shadow-xl transition-all duration-300 flex flex-col h-full group">
            <div class="relative h-48 overflow-hidden bg-gray-100 dark:bg-gray-800">
                <!-- Imagen Real -->
                <img 
                    src={project.image} 
                    alt={project.title} 
                    class="w-full h-full object-cover object-top transition-transform duration-700 group-hover:scale-110"
                />
                
                <!-- Overlay de acciones -->
                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-4 backdrop-blur-sm">
                    <button 
                        data-url={project.demoUrl}
                        class="preview-btn px-4 py-2 bg-white text-gray-900 rounded-full font-bold text-sm transform translate-y-4 group-hover:translate-y-0 transition-all duration-300 hover:scale-105 flex items-center gap-2 shadow-lg"
                    >
                        <span>üëÅÔ∏è</span> Vista Previa
                    </button>
                    <a 
                        href={project.demoUrl} 
                        target="_blank"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm transform translate-y-4 group-hover:translate-y-0 transition-all duration-300 delay-75 hover:scale-105 flex items-center gap-2 shadow-lg"
                    >
                        <span>üîó</span> Abrir App
                    </a>
                </div>
            </div>

            <div class="p-6 flex flex-col flex-grow">
                <div class="flex gap-2 mb-3">
                    {project.tags.map(tag => (
                        <span class="text-[10px] font-bold uppercase tracking-wider bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 px-2 py-1 rounded-md border border-indigo-100 dark:border-indigo-500/20">
                            {tag}
                        </span>
                    ))}
                </div>

                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
                    {project.title}
                </h3>
                <p class="text-gray-600 dark:text-gray-400 text-sm mb-6 flex-grow">
                    {project.description}
                </p>

                <div class="pt-4 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center">
                   <span class="text-xs text-gray-500">
                        {new Date(project.date).toLocaleDateString()}
                   </span>
                   <a 
                    href={project.repoUrl}
                    target="_blank"
                    class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 flex items-center gap-1 group/github"
                   >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github transition-colors group-hover/github:text-indigo-500"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                    C√≥digo
                   </a>
                </div>
            </div>
          </article>
        ))
      }
    </div>

    <!-- Call to Action -->
    <section class="mt-20 text-center py-12 bg-gray-50 dark:bg-slate-800/50 rounded-3xl border border-gray-100 dark:border-gray-700">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">¬øTienes una idea en mente?</h2>
        <p class="text-gray-600 dark:text-gray-300 mb-8 max-w-xl mx-auto">
            Estoy siempre buscando nuevos retos y colaboraciones open source.
        </p>
        <a href="https://github.com/JosePrograming25" target="_blank" class="inline-flex items-center gap-2 px-6 py-3 bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-bold rounded-full hover:bg-gray-800 dark:hover:bg-gray-100 transition-all">
            <span class="text-xl">üê±</span> Ver mi GitHub
        </a>
    </section>

    <!-- Modal de Vista Previa (Estilo Laptop) -->
    <dialog id="preview-modal" class="backdrop:bg-black/90 w-[90vw] h-[85vh] max-w-6xl rounded-none bg-transparent p-0 overflow-visible m-auto group open:animate-fade-in-up">
        <div class="flex flex-col h-full bg-[#1e1e1e] rounded-t-xl rounded-b-md shadow-2xl border border-gray-700 ring-4 ring-gray-800">
            <!-- Laptop Header / Toolbar -->
            <div class="flex items-center justify-between px-4 py-3 bg-[#2d2d2d] rounded-t-lg border-b border-black">
                <!-- Traffic Lights -->
                <div class="flex items-center gap-2">
                    <button id="close-modal-btn" class="w-3 h-3 rounded-full bg-red-500 hover:bg-red-600 transition-colors shadow-inner" aria-label="Cerrar"></button>
                    <div class="w-3 h-3 rounded-full bg-yellow-500 shadow-inner"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500 shadow-inner"></div>
                </div>

                <!-- Fake Address Bar -->
                <div class="flex items-center justify-center flex-grow mx-8">
                     <div class="bg-[#1a1a1a] text-gray-400 text-xs px-3 py-1.5 rounded-md flex items-center gap-2 min-w-[200px] justify-center border border-gray-700 shadow-inner group-hover:text-white transition-colors">
                        <span class="text-gray-600">üîí</span>
                        <span id="url-display" class="font-mono opacity-80">https://myapp.com</span>
                     </div>
                </div>

                <!-- External Link -->
                <a id="modal-external-link" href="#" target="_blank" class="text-gray-400 hover:text-white transition-colors" title="Abrir en pesta√±a nueva">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                </a>
            </div>

            <!-- Iframe Container -->
            <div class="flex-grow relative bg-white overflow-hidden rounded-b-sm group relative">
                <div id="loader" class="absolute inset-0 flex flex-col items-center justify-center bg-[#1e1e1e] z-10">
                    <div class="w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <span class="text-gray-400 text-sm animate-pulse">Cargando aplicaci√≥n...</span>
                </div>
                <!-- Screen Glare/Reflection Effect -->
                <div class="absolute inset-0 bg-gradient-to-tr from-white/5 to-transparent pointer-events-none z-20"></div>
                
                <iframe id="project-frame" src="" class="w-full h-full border-0" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
            </div>
        </div>
        
        <!-- Laptop Base (Visual only) -->
        <div class="h-4 bg-[#252525] rounded-b-xl mx-4 shadow-lg border-t border-gray-800 flex justify-center">
             <div class="w-20 h-1 bg-[#1a1a1a] rounded-b-md"></div>
        </div>
    </dialog>
  </main>
</Layout>

<script>
    const modal = document.getElementById('preview-modal') as HTMLDialogElement;
    const iframe = document.getElementById('project-frame') as HTMLIFrameElement;
    const closeBtn = document.getElementById('close-modal-btn');
    const externalLink = document.getElementById('modal-external-link') as HTMLAnchorElement;
    const urlDisplay = document.getElementById('url-display');
    const previewBtns = document.querySelectorAll('.preview-btn');
    const loader = document.getElementById('loader');

    previewBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            const button = (e.target as HTMLElement).closest('button');
            const url = button?.dataset.url;
            
            if(url && modal && iframe) {
                if(loader) loader.style.display = 'flex';
                iframe.src = url;
                if(externalLink) externalLink.href = url;
                if(urlDisplay) urlDisplay.textContent = url.replace('https://', '');
                
                iframe.onload = () => {
                   if(loader) loader.style.display = 'none';
                };

                modal.showModal();
            }
        });
    });

    if(closeBtn && modal) {
        closeBtn.addEventListener('click', () => {
            modal.close();
            if(iframe) iframe.src = '';
        });
    }

    if(modal) {
        modal.addEventListener('click', (e) => {
            const rect = modal.getBoundingClientRect();
            // Closing on backdrop click needs adjustment because of the laptop visual elements overflowing
            // Simple check: if click is outside the main content area (roughly)
            // But dialog backdrop covers everything. 
            if (e.target === modal) {
                 modal.close();
                 if(iframe) iframe.src = '';
            }
        });
    }
</script>
