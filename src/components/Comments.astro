<section class="max-w-3xl mx-auto px-6 py-10">
  <div id="giscus-container">
    <script
      src="https://giscus.app/client.js"
      data-repo="JosePrograming25/JProgramingBlog"
      data-repo-id="R_kgDOQLwgNw"
      data-category="Announcements"
      data-category-id="DIC_kwDOQLwgN84Czc5j"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="preferred_color_scheme"
      data-lang="es"
      data-loading="lazy"
      crossorigin="anonymous"
      async></script>
  </div>
</section>

<script>
  // Theme synchronization logic
  const getTheme = () => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  };

  const updateGiscusTheme = () => {
    const theme = getTheme();
    const giscusTheme = theme === "dark" ? "dark" : "light";

    const iframe = document.querySelector<HTMLIFrameElement>(
      "iframe.giscus-frame"
    );
    if (!iframe) return;

    iframe.contentWindow?.postMessage(
      { giscus: { setConfig: { theme: giscusTheme } } },
      "https://giscus.app"
    );
  };

  // Update on load
  // Note: The script tag above handles initial load with "preferred_color_scheme",
  // but we might want to force our specific theme if it differs from system preference.
  // However, giscus "preferred_color_scheme" usually matches system.
  // If we want strict sync with our toggle, we should use specific themes.

  // Let's try to set the initial theme attribute based on our current state if possible,
  // but since it's a script tag, we can't easily change attributes before load without more complex logic.
  // Instead, we'll rely on the postMessage update after load.

  window.addEventListener("load", updateGiscusTheme);

  // Listen for theme changes (custom event or observer)
  // Since our ThemeToggle modifies document class and localStorage, we can observe class changes on html
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (
        mutation.type === "attributes" &&
        mutation.attributeName === "class"
      ) {
        updateGiscusTheme();
      }
    });
  });

  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ["class"],
  });
</script>
